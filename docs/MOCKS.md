# Mock Generation for Testing

This project uses automatically generated mocks for unit testing using `github.com/golang/mock` with `//go:generate` directives.

## Quick Start

```bash
# Generate all code (including mocks) - Most idiomatic Go way
make generate

# Or generate mocks specifically
make mocks

# Clean generated mocks  
make mocks-clean

# Full development workflow (includes code generation)
make dev
```

## Generated Mocks

### DAGRepository Mock
- **Location**: `internal/usecase/testdata/mocks/dag_repository_mock.go`
- **Source**: `internal/usecase/dag_repository.go` (with `//go:generate` directive)
- **Used by**: `internal/usecase/list_dags_test.go`

### App Interface Mock  
- **Location**: `internal/adapter/http/testdata/mocks/app_mock.go`
- **Source**: `internal/adapter/http/dag.go` (with `//go:generate` directive)
- **Used by**: `internal/adapter/http/dag_handler_test.go`

## Go Generate Directives

The mocks are generated using `//go:generate` directives placed right next to the interface definitions:

**internal/usecase/dag_repository.go:**
```go
//go:generate go run github.com/golang/mock/mockgen -source=dag_repository.go -destination=testdata/mocks/dag_repository_mock.go -package=mocks

type DAGRepository interface {
    // ... interface methods
}
```

**internal/adapter/http/dag.go:**
```go
//go:generate go run github.com/golang/mock/mockgen -source=dag.go -destination=testdata/mocks/app_mock.go -package=mocks

type App interface {
    // ... interface methods  
}
```

## Usage Example

```go
import (
    "davidterranova/jurigen/internal/usecase/testdata/mocks"
    "github.com/golang/mock/gomock"
)

func TestMyFunction(t *testing.T) {
    ctrl := gomock.NewController(t)
    defer ctrl.Finish()
    
    mockRepo := mocks.NewMockDAGRepository(ctrl)
    mockRepo.EXPECT().List(gomock.Any()).Return([]uuid.UUID{}, nil)
    
    // ... test logic
}
```

## Directory Structure

```
internal/
├── usecase/
│   ├── testdata/mocks/          # Generated DAGRepository mock
│   └── list_dags_test.go        # Tests using generated mocks
└── adapter/http/
    ├── testdata/mocks/          # Generated App mock  
    └── dag_handler_test.go      # Tests using generated mocks
```

## Standard Go Workflow

You can also use standard Go commands directly:

```bash
# Generate all code (most idiomatic)
go generate ./...

# Generate mocks for specific packages
go generate ./internal/usecase/
go generate ./internal/adapter/http/
```

## Notes

- **Idiomatic Go**: Uses `//go:generate` directives which is the standard Go way
- **Self-documenting**: Generation commands are next to interface definitions
- **IDE Integration**: Most Go IDEs understand and can trigger `//go:generate`
- **Import Cycle Safe**: `testdata/` directories avoid dependency issues
- **Convention**: `testdata/` directories are ignored by Go build tools
- **Auto-regeneration**: Mocks regenerate when running `make dev` or `make generate`
- **Generated Code**: All files include `// Code generated by MockGen. DO NOT EDIT.` header
